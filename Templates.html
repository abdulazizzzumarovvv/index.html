<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Copy Templates with Google Drive Sync</title>
<style>
    body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: auto;
        padding: 20px;
        background: #f4f4f4;
    }
    h1 { text-align: center; }
    .template {
        background: white;
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px 0;
        border-radius: 8px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 10px;
    }
    .text { flex: 1; word-break: break-word; }
    .buttons { display: flex; gap: 5px; }
    button {
        padding: 5px 10px;
        cursor: pointer;
        border: none;
        border-radius: 5px;
    }
    .copy-btn { background: #007BFF; color: white; }
    .edit-btn { background: #5bc0de; color: black; }
    .delete-btn { background: #dc3545; color: white; }
    .add-btn { background: #28a745; color: white; }
    .google-btn { background: orange; color: white; margin-bottom: 10px; }
    #input-area { display: flex; gap: 10px; margin-bottom: 15px; }
    #new-template {
        flex: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 5px;
    }
</style>
</head>
<body>

<h1>üìã Templates</h1>

<!-- –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
<button class="google-btn" onclick="handleAuthClick()">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google</button>

<div id="input-area">
    <input type="text" id="new-template" placeholder="New Template">
    <button class="add-btn" onclick="addTemplate()">Add</button>
</div>

<div id="templates-container"></div>

<!-- Google API -->
<script src="https://apis.google.com/js/api.js"></script>
<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
/* ======= –ù–ê–°–¢–†–û–ô–ö–ò GOOGLE API ======= */
const CLIENT_ID = "411923994570-bbq5dpa7vg9dj088dh012f7i1o2jm800.apps.googleusercontent.com"; // –≤—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–≤–æ–π Client ID
const API_KEY = "";
const SCOPES = "https://www.googleapis.com/auth/drive.file";

let templates = JSON.parse(localStorage.getItem("templates")) || [];
let fileId = null;

/* ======= –†–ï–ù–î–ï–†–ò–ù–ì ======= */
function saveLocal() {
    localStorage.setItem("templates", JSON.stringify(templates));
}
function renderTemplates() {
    let container = document.getElementById("templates-container");
    container.innerHTML = "";
    templates.forEach((t, i) => createTemplateElement(t, i));
}
function createTemplateElement(text, index) {
    let container = document.getElementById("templates-container");
    let div = document.createElement("div");
    div.className = "template";

    let p = document.createElement("div");
    p.className = "text";
    p.textContent = text;

    let btnGroup = document.createElement("div");
    btnGroup.className = "buttons";

    let copyBtn = document.createElement("button");
    copyBtn.className = "copy-btn";
    copyBtn.textContent = "Copy";
    copyBtn.onclick = () => navigator.clipboard.writeText(text);

    let editBtn = document.createElement("button");
    editBtn.className = "edit-btn";
    editBtn.textContent = "Edit";
    editBtn.onclick = () => {
        let newText = prompt("Edit", templates[index]);
        if (newText) {
            templates[index] = newText.trim();
            saveLocal();
            saveToDrive();
            renderTemplates();
        }
    };

    let deleteBtn = document.createElement("button");
    deleteBtn.className = "delete-btn";
    deleteBtn.textContent = "Delete";
    deleteBtn.onclick = () => {
        templates.splice(index, 1);
        saveLocal();
        saveToDrive();
        renderTemplates();
    };

    btnGroup.appendChild(copyBtn);
    btnGroup.appendChild(editBtn);
    btnGroup.appendChild(deleteBtn);
    div.appendChild(p);
    div.appendChild(btnGroup);
    container.appendChild(div);
}

/* ======= –õ–û–ö–ê–õ–¨–ù–û–ï –î–û–ë–ê–í–õ–ï–ù–ò–ï ======= */
function addTemplate() {
    let input = document.getElementById("new-template");
    let text = input.value.trim();
    if (!text) return;
    templates.push(text);
    saveLocal();
    saveToDrive();
    renderTemplates();
    input.value = "";
}

/* ======= GOOGLE DRIVE API ======= */
function gapiLoaded() {
    gapi.load('client:auth2', initClient);
}
function initClient() {
    gapi.client.init({
        apiKey: API_KEY,
        clientId: CLIENT_ID,
        scope: SCOPES
    }).then(() => {
        if (gapi.auth2.getAuthInstance().isSignedIn.get()) {
            listOrCreateFile();
        }
    });
}
function handleAuthClick() {
    gapi.auth2.getAuthInstance().signIn().then(listOrCreateFile);
}
function listOrCreateFile() {
    gapi.client.drive.files.list({
        q: "name='templates.json' and mimeType='application/json'",
        spaces: 'drive',
        fields: 'files(id, name)'
    }).then(response => {
        let files = response.result.files;
        if (files && files.length > 0) {
            fileId = files[0].id;
            loadFromDrive();
        } else {
            createFileOnDrive();
        }
    });
}
function createFileOnDrive() {
    const fileContent = JSON.stringify(templates);
    const file = new Blob([fileContent], {type: 'application/json'});
    const metadata = { name: 'templates.json', mimeType: 'application/json' };
    const form = new FormData();
    form.append('metadata', new Blob([JSON.stringify(metadata)], {type: 'application/json'}));
    form.append('file', file);
    fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart', {
        method: 'POST',
        headers: new Headers({ 'Authorization': 'Bearer ' + gapi.auth.getToken().access_token }),
        body: form
    }).then(res => res.json()).then(data => {
        fileId = data.id;
    });
}
function saveToDrive() {
    if (!fileId) return;
    const fileContent = JSON.stringify(templates);
    fetch(`https://www.googleapis.com/upload/drive/v3/files/${fileId}?uploadType=media`, {
        method: 'PATCH',
        headers: new Headers({
            'Authorization': 'Bearer ' + gapi.auth.getToken().access_token,
            'Content-Type': 'application/json'
        }),
        body: fileContent
    });
}
function loadFromDrive() {
    gapi.client.drive.files.get({
        fileId: fileId,
        alt: 'media'
    }).then(response => {
        try {
            templates = JSON.parse(response.body);
            saveLocal();
            renderTemplates();
        } catch(e) {
            console.error("–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Drive", e);
        }
    });
}

/* ======= –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ======= */
function start() {
    renderTemplates();
    gapiLoaded();
}
start();
</script>

</body>
</html>
